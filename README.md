# 賢者の精算 - 経費・出張申請管理システム

## 概要

賢者の精算は、企業の経費申請・出張申請を効率的に管理するためのWebアプリケーションです。Supabaseをバックエンドとして使用し、React + TypeScriptで構築されています。

## 主な機能

### 🔐 認証・ユーザー管理
- ユーザー登録・ログイン・ログアウト
- 役割ベースのアクセス制御（一般ユーザー、マネージャー、管理者）
- パスワードリセット
- プロフィール管理

### 📊 ダッシュボード
- リアルタイム統計情報（今月の経費、出張費用、申請件数）
- 最近の申請一覧
- アクティビティフィード
- 通知管理

### 📝 申請管理
- 経費申請の作成・編集・削除
- 出張申請の作成・編集・削除
- 申請ステータスの管理（待機中、承認済み、却下、キャンセル）
- 申請履歴の閲覧

### 👥 管理者機能
- 全ユーザーの申請状況の確認
- 申請の承認・却下
- ユーザー管理
- システム統計

## 技術スタック

### フロントエンド
- **React 18** - UIライブラリ
- **TypeScript** - 型安全性
- **Tailwind CSS** - スタイリング
- **Lucide React** - アイコン
- **Vite** - ビルドツール

### バックエンド
- **Supabase** - バックエンドサービス
  - PostgreSQL データベース
  - リアルタイム機能
  - 認証・認可
  - Row Level Security (RLS)

### 状態管理
- **React Hooks** - ローカル状態管理
- **カスタムフック** - データ操作と認証状態管理

## セットアップ手順

### 1. 前提条件
- Node.js 18以上
- npm または yarn
- Supabaseアカウント

### 2. リポジトリのクローン
```bash
git clone <repository-url>
cd kenja-cursor-1
```

### 3. 依存関係のインストール
```bash
npm install
```

### 4. 環境変数の設定
`.env.local`ファイルを作成し、Supabaseの設定を追加：

```env
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 5. Supabaseデータベースのセットアップ

#### 5.1 プロジェクトの作成
1. [Supabase](https://supabase.com)にアクセス
2. 新しいプロジェクトを作成
3. プロジェクトのURLとanon keyを取得

#### 5.2 データベーススキーマの初期化
1. Supabaseダッシュボードで「SQL Editor」を開く
2. `database_init.sql`の内容をコピーして実行
3. テーブル、RLSポリシー、インデックスが作成される

### 6. 開発サーバーの起動
```bash
npm run dev
```

アプリケーションが `http://localhost:5173` で起動します。

## データベース構造

### テーブル一覧

#### `profiles` - ユーザープロフィール
- 基本情報（名前、メール、会社、役職、電話番号）
- 役割（user, manager, admin）
- 部署情報

#### `expense_applications` - 経費申請
- 申請内容（タイトル、説明、金額、カテゴリ）
- ステータス管理
- 領収書URL
- 承認情報

#### `business_trip_applications` - 出張申請
- 出張先、期間、目的
- 推定費用
- ステータス管理
- 承認情報

#### `notifications` - 通知
- 通知タイプ（info, success, warning, error）
- 既読管理
- タイムスタンプ

### セキュリティ
- **Row Level Security (RLS)** により、ユーザーは自分のデータのみアクセス可能
- 管理者・マネージャーは全ユーザーのデータを閲覧・編集可能
- 認証はSupabase Authを使用

## カスタムフック

### `useAuth`
認証状態の管理とログイン・ログアウト機能を提供

### `useUserData`
ユーザーデータの取得と管理、統計情報の計算

### `useDataOperations`
データの作成・更新・削除操作を管理

## コンポーネント構造

```
src/
├── components/
│   ├── auth/           # 認証関連コンポーネント
│   ├── Dashboard.tsx   # メインダッシュボード
│   ├── Sidebar.tsx     # サイドバーナビゲーション
│   ├── TopBar.tsx      # トップバー
│   └── ...            # その他の機能コンポーネント
├── hooks/              # カスタムフック
├── lib/                # ライブラリ設定
└── types/              # TypeScript型定義
```

## 開発ガイドライン

### コードスタイル
- ESLint + Prettier を使用
- TypeScriptの厳密な型チェック
- コンポーネントは関数コンポーネント + Hooks

### 状態管理
- ローカル状態は `useState`
- 共有状態はカスタムフック
- 副作用は `useEffect` と `useCallback`

### エラーハンドリング
- try-catch による包括的なエラー処理
- ユーザーフレンドリーなエラーメッセージ
- ログ出力によるデバッグ支援

## デプロイ

### 本番環境
```bash
npm run build
```

### Supabase
- データベースはSupabaseで管理
- 環境変数で本番環境の設定を切り替え

## トラブルシューティング

### よくある問題

#### 1. 認証エラー
- 環境変数が正しく設定されているか確認
- Supabaseプロジェクトの設定を確認

#### 2. データが表示されない
- RLSポリシーが正しく設定されているか確認
- データベースにサンプルデータが挿入されているか確認

#### 3. ビルドエラー
- TypeScriptの型エラーを確認
- 依存関係のバージョンを確認

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題が発生した場合や質問がある場合は、GitHubのIssuesで報告してください。

## 更新履歴

### v1.0.0
- 基本的な認証・認可システム
- 経費・出張申請管理
- ダッシュボード機能
- 管理者機能
- リアルタイム通知システム